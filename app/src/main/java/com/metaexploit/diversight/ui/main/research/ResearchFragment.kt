package com.metaexploit.diversight.ui.main.research

import android.content.Intent
import android.os.Bundle
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import androidx.appcompat.widget.LinearLayoutCompat
import androidx.constraintlayout.widget.ConstraintLayout
import androidx.constraintlayout.widget.ConstraintSet
import androidx.databinding.DataBindingUtil
import androidx.fragment.app.Fragment
import androidx.fragment.app.activityViewModels
import androidx.navigation.fragment.findNavController
import androidx.navigation.fragment.navArgs
import com.google.gson.Gson
import com.metaexploit.diversight.R
import com.metaexploit.diversight.databinding.FragmentResearchBinding
import com.metaexploit.diversight.remote.Form
import com.metaexploit.diversight.remote.FormQuestion
import com.metaexploit.diversight.ui.done.DoneActivity
import com.metaexploit.diversight.ui.main.Header
import com.metaexploit.diversight.ui.main.MainViewModel
import timber.log.Timber
import java.util.ArrayList

class ResearchFragment : Fragment() {

    private lateinit var binding: FragmentResearchBinding

    private val args: ResearchFragmentArgs by navArgs()

    private val viewModel: MainViewModel by activityViewModels()

    private val questionsAdapter: ResearchAdapter by lazy {
        ResearchAdapter(activity)
    }

    override fun onCreateView(
        inflater: LayoutInflater, container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View {

        viewModel.setVisibilityBN(false)

        // Inflate the layout for this fragment
        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_research, container, false)

        // Back button
        binding.btnBack.setOnClickListener {
            this.findNavController().popBackStack()
        }

        // Navigate to send activity
        binding.btnSend.setOnClickListener {
            val intent = Intent(activity, DoneActivity::class.java)
            startActivity(intent)
        }

        return binding.root
    }

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)

        val form = Gson().fromJson(args.form, Form::class.java)

        val title = when(form.type) {
            "nps" -> getString(R.string.title_research_header, "NPS")
            "adm" -> getString(R.string.title_research_header, "Admissional")
            "dem" -> getString(R.string.title_research_header, "Demissional")
            else -> ""
        }

        // Set title
        binding.apply {
            binding.header = Header(title)
        }

       binding.questions.adapter = questionsAdapter
        questionsAdapter.setList(form.questions)

    }
}