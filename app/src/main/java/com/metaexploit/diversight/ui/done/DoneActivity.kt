package com.metaexploit.diversight.ui.done

import android.content.Context
import android.content.Intent
import android.os.Bundle
import androidx.appcompat.app.AppCompatActivity
import androidx.appcompat.widget.AppCompatImageView
import androidx.appcompat.widget.AppCompatTextView
import androidx.databinding.DataBindingUtil
import com.google.gson.Gson
import com.metaexploit.diversight.R
import com.metaexploit.diversight.databinding.ActivityDoneBinding
import com.metaexploit.diversight.remote.Form
import com.metaexploit.diversight.ui.main.MainActivity
import com.metaexploit.diversight.ui.main.Header

class DoneActivity : AppCompatActivity() {

    private lateinit var binding: ActivityDoneBinding

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = DataBindingUtil.setContentView(this, R.layout.activity_done)

        val form = getSharedPref()

        val title = when (form.type) {
            "daily" -> getString(R.string.title_research_header, getString(R.string.daily))
            "weekly" -> getString(R.string.title_research_header, getString(R.string.weekly))
            "nps" -> getString(R.string.title_research_header, getString(R.string.nps))
            "adm" -> getString(R.string.title_research_header, getString(R.string.adm))
            else -> getString(R.string.title_research_header, getString(R.string.dem))
        }

        binding.apply {
            binding.header = Header(title)
        }

        binding.btnBackHome.setOnClickListener { startHomeActivity() }

        findViewById<AppCompatImageView>(R.id.imageStatus).setBackgroundResource(R.drawable.img_status_done)
        findViewById<AppCompatTextView>(R.id.textStatus).text = getString(R.string.status_done)
    }

    private fun getSharedPref(): Form {
        val sharedPref = this.getSharedPreferences(getString(R.string.id_shared_pref), Context.MODE_PRIVATE)
        val formJSON = sharedPref?.getString(getString(R.string.id_form), "")
        return Gson().fromJson(formJSON, Form::class.java)
    }

    override fun onBackPressed() {
        super.onBackPressed()
        startHomeActivity()
    }

    private fun startHomeActivity() {
        val intent = Intent(this, MainActivity::class.java)
        startActivity(intent)
    }
}